---
title: "Findings"
output: html_document
---

Final

Research Question

Background on Dependent variable - Assessment Ratio

Data Provided
```{r}
setwd("C:/Users/Vinnie/Documents")
load("res_data_w_geo.dta")
Initial <-data.frame(res_data_w_geo)
```
All variables
```{r}
#names(Initial)
```

Continuous Variables of Interest

Sale Price, Land Size, Land Value, Improvement Value, Assessment Value
```{r}
ggplot(Initial, aes(SALEPRICE)) +
  geom_histogram(bins = 200) +
  xlab("Sale Price") + 
  ylab("Frequency")

ggplot(Initial, aes(ASSESSEDVAL)) +
  geom_histogram(bins = 200)

ggplot(Initial, aes(LANDSIZE)) +
  geom_histogram(bins = 200)

ggplot(Initial, aes(LANDVAL)) +
  geom_histogram(bins = 200)

Initial$atsratio <- Initial$ASSESSEDVAL / Initial$SALEPRICE

ggplot(Initial, aes(atsratio)) +
  geom_histogram(bins = 200)  +
  xlab("ATS Ratio") + 
  ylab("Frequency")
  

```


We first look at the main variables of interest & discover that they are all extremely right tailed.

We know from prior knowledge that this would be the case. Many weird sales/properties exist, e.g. donations, auctions, foreclosures, condemtions. 

In an attempt to remedy this we remove the observations outside the interquartile range


Look at effect of this change on distribution of ats ratio

```{r}
ggplot(resdata, aes(atsratio)) +
  geom_histogram(bins = 200) +
  xlab("ATS Ratio") + 
  ylab("Frequency")

ggplot(resdata,aes(SALEPRICE))+
  geom_histogram(bins = 150) +
  xlab("Sale Price") + 
  ylab("Frequency")


ggplot(resdata, aes(LogSalesPrice)) +
  geom_histogram(bins = 150) +
  xlab("Sale Price") + 
  ylab("Frequency")

ggplot(resdata, aes(log(ASSESSEDVAL))) +
  geom_histogram(bins = 150) +
  xlab("") + 
  ylab("Frequency")



ggplot(resdata, aes(LANDSIZE)) +
  geom_histogram(bins = 150)

ggplot(resdata, aes(LogLandSize)) +
  geom_histogram(bins = 150)


ggplot(resdata,aes(LogMedianLandSize)) + 
  geom_histogram(bins = 150)
```



Categorical Variables

Building Type, Building Quality, Number of Buildings, Building Condition, Bedrooms, Kitchens, Baths, Half-Baths, Garages
```{r}
BLDFreqs <- resdata %>% group_by(BLDTYPE) %>% summarise(n = n())
plotgroup <- resdata %>% left_join(BLDFreqs, by = c("BLDTYPE"))

ggplot(filter(plotgroup, n > 400), aes(BLDTYPE)) +
  geom_bar() + 
  xlab("Building Type") + 
  ylab("Frequency")

level_order_qual <- c("A","B","C","D","E","NA")

ggplot(resdata, aes(x = factor(QUAL_recode, level = level_order_qual))) +
  geom_bar() + 
  xlab("Quality") + 
  ylab("Frequency")


level_order_cond <- c("EX - Excellent","VG - Very Good","GD - Good","AV - Average","FR - Fair","PR - Poor","VP - Very Poor","UN - Unsound")

ggplot(resdata, aes(x = factor(COND, level = level_order_cond))) +
  geom_bar()+ 
  xlab("Condition") + 
  ylab("Frequency")

ggplot(resdata, aes(NUM_BLDS)) +
  geom_bar()

ggplot(resdata, aes(KITCHENS)) +
  geom_bar()

ggplot(resdata, aes(BEDROOMS)) + 
  geom_bar()


```


Temporal Variables

Date sold, Year Built
```{r}
ggplot(resdata, aes(SALEDATE,fill = factor(QUAL_recode, level = level_order_qual))) +
  geom_histogram(bins=100) + 
  theme(legend.title=element_blank()) + 
  xlab("Sale Date & Quality") + 
  ylab("Frequency")

ggplot(resdata, aes(SALEDATE)) +
  geom_histogram(bins=100) +
  theme(legend.title=element_blank()) + 
  xlab("Sale Date") + 
  ylab("Frequency")



ggplot(resdata, aes(SALEDATE, fill = factor(atsratiodecile))) +
  geom_histogram(bins=100) +
  theme(legend.title=element_blank()) + 
  xlab(" ")+
  ylab("Frequency")

ggplot(resdata, aes(YEARBLT, fill = factor(QUAL_recode, level = level_order_qual))) +
  geom_histogram(bins=100) +
  theme(legend.title=element_blank())

ggplot(resdata, aes(YEARBLT, fill = factor(COND, level = level_order_cond))) +
  geom_histogram(bins=100)+
  theme(legend.title=element_blank())

```

Census Data

```{r}
ggplot(resdata, aes(MEDIAN.INCOME)) + 
  geom_histogram()

ggplot(resdata, aes(LogMedianIncome)) + 
  geom_histogram()


ggplot(resdata, aes(Percent_NotHispanic_White)) + 
  geom_histogram() + 
  xlab("Percent White") + 
  ylab("Frequency")

ggplot(resdata, aes(Percent_Black)) + 
  geom_histogram() + 
  xlab("Percent Black") + 
  ylab("Frequency")

ggplot(resdata, aes(Percent_Hispanic)) + 
  geom_histogram() + 
  xlab("Percent Hispanic") + 
  ylab("Frequency")

```






Visualizations of variables with ats ratio

```{r}
ggplot(resdata, aes(atsratio, fill = factor(QUAL_recode, level = level_order_qual))) +
  geom_histogram(bins=100) +
  theme(legend.title=element_blank())


ggplot(resdata, aes(atsratio, fill = factor(COND, level = level_order_cond))) +
  geom_histogram(bins=100)+
  theme(legend.title=element_blank())
```



Population analysis 

Census Data visualizations

Shapefile
```{r}
Mil_County<-st_read("C:/Users/Vinnie/Desktop/GitHub/Milwaukee-Property-Assessment/Shapefiles/Census_Tracts.shp")

#Mil_County<-st_read("/Users/vinniepalazeti/Desktop/GitGit/Milwaukee-Property-Assessment/Shapefiles/Census_Tracts.shp")

#Makeup
st_geometry_type(Mil_County)
#Coordinate Reference System
st_crs(Mil_County)
#World Geodetic System 1984

`%notin%` <- Negate(`%in%`)

Mil_County2 <- Mil_County %>%
  filter(OBJECTID %notin% c(263)) %>%
  rename(GEO_TRACT = Tract_ID_I)

Mil_County3 <- st_crop(Mil_County2,xmin=-88.06995, xmax=-87.81955, ymin=42.92, ymax=43.19259)

Remove <- setdiff(Mil_County2$GEO_TRACT,resdata$GEO_TRACT)

Mil_County4 <- Mil_County3 %>% 
  left_join(resdata, by = "GEO_TRACT") %>%
  mutate(lighter = ifelse(GEO_TRACT %in% Remove, 1,0))

lighter_color <- Mil_County4 %>% filter(lighter==1)

ggplot() + 
  geom_sf(data = Mil_County4, color = "black", fill = "pink") + 
  ggtitle("Milwaukee!") + 
  coord_sf()


```


Racial population distribution

In stark relief 

```{r}
ggplot() + 
  geom_sf(aes(fill=Percent_Black), color='transparent', data = Mil_County4) +
  geom_sf(fill = 'transparent', color='white', data = Mil_County4) + 
  geom_sf(fill='grey90', color = 'white',data = lighter_color)+
  scale_fill_viridis_c(name ='Percent Black')+
  #ggtitle("Milwaukee Census Tracts by Percent Black Population") + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        rect = element_blank())+
  coord_sf()


ggplot() + 
  geom_sf(aes(fill=Percent_NotHispanic_White), color='transparent', data = Mil_County4) +
  geom_sf(fill = 'transparent', color='white', data = Mil_County4) + 
  geom_sf(fill='grey90', color = 'white',data = lighter_color)+
  scale_fill_viridis_c(name ='Percent White')+
  #ggtitle("Milwaukee Census Tracts by Percent White Population") + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        rect = element_blank())+
  coord_sf()

ggplot() + 
  geom_sf(aes(fill=Percent_Hispanic), color='transparent', data = Mil_County4) +
  geom_sf(fill = 'transparent', color='white', data = Mil_County4) + 
  geom_sf(fill='grey90', color = 'white',data = lighter_color)+
  scale_fill_viridis_c(name ='Percent Hispanic')+
  #ggtitle("Milwaukee Census Tracts by Percent Hispanic Population") + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        rect = element_blank())+
  coord_sf()
```

Socio-Economic Population distribution 

```{r}
ggplot() + 
  geom_sf(aes(fill=IncomeDecile), color='transparent', data = Mil_County4) +
  geom_sf(fill = 'transparent', color='white', data = Mil_County4) + 
  geom_sf(fill='grey90', color = 'white',data = lighter_color)+
  scale_fill_viridis_c(name ='Income Decile')+
  #ggtitle("Milwaukee Census Tracts by Income Deciles") + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        rect = element_blank())+
  coord_sf()


ggplot() + 
  geom_sf(aes(fill=Percent_Renter), color='transparent', data = Mil_County4) +
  geom_sf(fill = 'transparent', color='white', data = Mil_County4) + 
  geom_sf(fill='grey90', color = 'white',data = lighter_color)+
  scale_fill_viridis_c(name ='Percent Renter')+
  #ggtitle("Milwaukee Census Tracts by Percent Renter") + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        rect = element_blank())+
  coord_sf()

ggplot() + 
  geom_sf(aes(fill=renterdecile), color='transparent', data = Mil_County4) +
  geom_sf(fill = 'transparent', color='white', data = Mil_County4) + 
  geom_sf(fill='grey90', color = 'white',data = lighter_color)+
  scale_fill_viridis_c(name ='Percent Renter Deciles')+
  #ggtitle("Milwaukee Census Tracts by Percent Renter Deciles") + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        rect = element_blank())+
  coord_sf()


ggplot() + 
  geom_sf(aes(fill=Percent_TotalPOPIncomeBelowPovRate), color='transparent', data = Mil_County4) +
  geom_sf(fill = 'transparent', color='white', data = Mil_County4) + 
  geom_sf(fill='grey90', color = 'white',data = lighter_color)+
  scale_fill_viridis_c(name ='Percent of in Poverty')+
  #ggtitle("Milwaukee Census Tracts by Percent Population with Income Below Poverty Rate") + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        rect = element_blank())+
  coord_sf()

```



```{r}

ggplot() + 
  geom_sf(aes(fill=atsratiodecile), color='transparent', data = Mil_County4) +
  geom_sf(fill = 'transparent', color='white', data = Mil_County4) + 
  geom_sf(fill='grey90', color = 'white',data = lighter_color)+
  scale_fill_viridis_c(name ='ATS Ratio Decile')+
  ggtitle("Milwaukee Census Tracts by ATS Ratio Decile") + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        rect = element_blank())+
  coord_sf()

ggplot() + 
  geom_sf(aes(fill=atsratioMedian), color='transparent', data = Mil_County4) +
  geom_sf(fill = 'transparent', color='white', data = Mil_County4) + 
  geom_sf(fill='grey90', color = 'white',data = lighter_color)+
  scale_fill_viridis_c(name ='ATS Ratio Decile')+
  ggtitle("Milwaukee Census Tracts by ATS Ratio Decile") + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        rect = element_blank())+
  coord_sf()


```


We very plainly see patterns



Next we go into Pre Regression Analysis

First with Racial Demographics

    
Median ATS Ratio by Percent Black Population Decile
```{r}
blackpop <- tapply(resdata$atsratio,resdata$blackdecile, summary)

medians <- c()
deciles <- 1:10
for (i in 1:10){
  medians[i] <- as.numeric(blackpop[[i]]['Median']) }

BlackATS <- data.frame("Medians" = medians,
                       "Deciles" = deciles)

print(BlackATS)
tapply(resdata$atsratio,resdata$blackdecile, summary)
```

    - The Median Assessment to Sale ratio decreases as the percent black population increases
    
    - As the percent of the black population increases in a tract, the assessment diverges from the sale value of the house
    
    - Homes in black neighborhoods are under assessed 
    
    
Median ATS Ratio by Percent White Population Decile
```{r}
whitepop <- tapply(resdata$atsratio,resdata$white_nonhispanic_decile, summary)

medians <- c()
deciles <- 1:10
for (i in 1:10){
  medians[i] <- as.numeric(whitepop[[i]]['Median']) }

WhiteATS <- data.frame("Medians" = medians,
                       "Deciles" = deciles)

print(WhiteATS)
tapply(resdata$atsratio,resdata$white_nonhispanic_decile, summary)
```

    - The Median Assessment to Sale ratio increases as the percent white population increases
    
    - As the percent of the white population increases in a tract, the assessment approaches the sale value of the house
    
    - Homes in white neighborhoods are over assessed (relative to black neighborhoods), homes are assessed closer to their true sale value
    
    - Homes in white neighborhoods show the opposite trend to black neighborhoods
    

    
Median ATS Ratio by Percent Hispanic Population Decile
```{r}
hispanicpop <- tapply(resdata$atsratio, resdata$hispaniddecile, summary)

medians <- c()
deciles <- 1:10
for (i in 1:10){
  medians[i] <- as.numeric(hispanicpop[[i]]['Median']) }

HispATS <- data.frame("Medians" = medians,
                       "Deciles" = deciles)

print(HispATS)
tapply(resdata$atsratio, resdata$hispaniddecile, summary)
```


    - See less of a trend here
    
  
Median ATS Ratio by Income Decile
```{r}
incomes <- tapply(resdata$atsratio,resdata$IncomeDecile, summary)

medians <- c()
deciles <- 1:10
for (i in 1:10){
  medians[i] <- as.numeric(incomes[[i]]['Median']) }

IncomeATS <- data.frame("Medians" = medians,
                       "Deciles" = deciles)


print(IncomeATS)
tapply(resdata$atsratio,resdata$IncomeDecile, summary)
```

    - The Median Assessment to Sale ratio increases as the Median Income of the tract Increase
    
    - As the income increases, the assessment approaches the sale value of the house
    


Median ATS Ratio by Sales Decile
```{r}
sales <- tapply(resdata$atsratio,resdata$salesdecile, summary)

medians <- c()
deciles <- 1:10
for (i in 1:10){
  medians[i] <- as.numeric(sales[[i]]['Median']) }

SaleATS <- data.frame("Medians" = medians,
                       "Deciles" = deciles)

print(SaleATS)
tapply(resdata$atsratio, resdata$salesdecile, summary)

```

    - The Median Assessment to Sale ratio decreases as the sale price increases
    
    - As the sale price of a house increases, the assessment diverges from the sale value of the house
    
    - Higher prices homes are under assessed  
    
  
Median ATS Ratio by Percent Population with Income Below Poverty Rate
```{r}
pov <- tapply(resdata$atsratio,resdata$TotalPOPIncome_PovertyRateDecile, summary)

medians <- c()
deciles <- 1:10
for (i in 1:10){
  medians[i] <- as.numeric(pov[[i]]['Median']) }

PovATS <- data.frame("Medians" = medians,
                       "Deciles" = deciles)

print(PovATS)
tapply(resdata$atsratio,resdata$TotalPOPIncome_PovertyRateDecile, summary)

```

Median ATS Ratio by Percent Renter Population
```{r}
renter <- tapply(resdata$atsratio,resdata$renterdecile, summary)

medians <- c()
deciles <- 1:10
for (i in 1:10){
  medians[i] <- as.numeric(renter[[i]]['Median']) }

RentATS <- data.frame("Medians" = medians,
                       "Deciles" = deciles)

print(RentATS)
tapply(resdata$atsratio,resdata$renterdecile, summary)
```

Mann Kendall Trend Test

This is a test for monotonic trend
```{r}
cat("Black Population Deciles","\n")
MannKendall(BlackATS$Medians)
cat("---","\n")

cat("White Population Deciles","\n")
MannKendall(WhiteATS$Medians)
cat("---","\n")

cat("Hispanic Population Deciles","\n")
MannKendall(HispATS$Medians)
cat("---","\n")

cat("Income Deciles","\n")
MannKendall(IncomeATS$Medians)
cat("---","\n")

cat("Sale Price Deciles","\n")
MannKendall(SaleATS$Medians)
cat("---","\n")

cat("Renter Population Deciles","\n")
MannKendall(RentATS$Medians)
cat("---","\n")

cat("Poverty Rate Deciles","\n")
MannKendall(PovATS$Medians)
```

Black, White, Income, Sale, & Poverty are found to have Monotonic trends

Renter & Hispanic are found to not have Monotonic trends


Assessing Correlations

Consider large correlation plot of all variables needed for regression

Tract Level Variables & Observation Level Variables

Correlations
```{r}

Observation_independents <- resdata %>% 
  select(atsratio,SALEPRICE,YEARBLT,LANDSIZE, SaleYear,SaleMonth,ASSESSEDVAL, Kitchen_Average, Kitchen_Excellent, Kitchen_Fair, Kitchen_Good, Kitchen_Poor, Kitchen_VeryGood, Kitchen_VeryPoor, KITCHENS, FullBath_Average,FullBath_Excellent,FullBath_Fair,FullBath_Good,FullBath_Poor,FullBath_VeryGood,FULLBATHS, Cond_VeryPoor,Cond_Average,Cond_Excellent,Cond_Fair,Cond_Good,Cond_Poor,Cond_VeryGood, Qual_A,Qual_B,Qual_C,Qual_C,Qual_D,Qual_E, BEDROOMS, Ranch,Cape_Cod,Milwaukee_Bungalow,Res_OS_A,Colonial,Duplex,Res_OS_2sty,Other)

Obs_cors <- cor(Observation_independents)

corrplot(Obs_cors,method='circle', type = 'lower', tl.col="black")

corrplot(Obs_cors,method='circle', tl.col="black")

Tract_independents <- resdata  %>% select(GEO_TRACT,MedianTractATSRatio,MEDIAN.INCOME,Percent_Black,Percent_NotHispanic_White,Percent_Hispanic,Percent_TotalPOPIncomeBelowPovRate)

Tract_independents <- Tract_independents %>% 
  select(-c(GEO_TRACT)) %>%
  rename(`Median Income` = `MEDIAN.INCOME`,
         `Percent Black` = `Percent_Black`,
         `Median ATS Ratio` = `MedianTractATSRatio`,
         `Percent White` = `Percent_NotHispanic_White`,
         `Percent Hispanic` = `Percent_Hispanic`,
         `Percent Income Poverty` = `Percent_TotalPOPIncomeBelowPovRate`
         )

Tract_cors <- cor(Tract_independents)

corrplot(Tract_cors,method='circle', type = 'lower', tl.col="black")
```


In a crude way we can check the relationship between correlated variables via R^2

```{r}

#summary(lm(MEDIAN.INCOME ~ Percent_Black, data = resdata))
#plot(lm(MEDIAN.INCOME ~ Percent_Black, data = resdata))



ggplot(resdata, aes(x = Percent_Black, y = MEDIAN.INCOME)) +
  geom_point() +
  geom_smooth(method = lm) +
  xlab("Percent Black") +
  ylab("Median Income")



#summary(lm(MEDIAN.INCOME ~ Percent_NotHispanic_White, data = resdata))
#plot(lm(MEDIAN.INCOME ~ Percent_NotHispanic_White, data = resdata))


ggplot(resdata, aes(x = Percent_NotHispanic_White, y = MEDIAN.INCOME)) +
  geom_point() +
  geom_smooth(method = lm) +
  xlab("Percent White") +
  ylab("Median Income")




#summary(lm(MEDIAN.INCOME ~ Percent_Hispanic, data = resdata))
#plot(lm(MEDIAN.INCOME ~ Percent_NotHispanic_White, data = resdata))

ggplot(resdata, aes(x = Percent_Hispanic, y = MEDIAN.INCOME)) +
  geom_point() +
  geom_smooth(method = lm) +
  xlab("Percent Hispanic") +
  ylab("Median Income")



```


 
Regression Analysis

MACRO Trends

```{r}

fitdata <- resdata  %>%
  select(MedianTractATSRatio,
         Percent_Black,Percent_Hispanic,Percent_NotHispanic_White,
         MedianLandSize, MedianTractSalesPrice, MEDIAN.INCOME,GEO_TRACT) %>% 
  distinct(GEO_TRACT,.keep_all = TRUE) %>% 
  arrange(GEO_TRACT) %>%
  select(-c(GEO_TRACT)) %>%
  scale(center = T,scale=T) %>%
  as.data.frame()

tracts <- resdata %>% 
  distinct(GEO_TRACT) %>% 
  arrange(GEO_TRACT)

fitdata<- cbind(fitdata,tracts)

mod <- lm(MedianTractATSRatio ~   Percent_Black  + Percent_Hispanic  + MedianLandSize + MedianTractSalesPrice + MEDIAN.INCOME, data = fitdata)

summary(mod)
plot(mod)

```

We don't see any useful information from the macro trends regression



#######################################################
##############  ATS RATIO AS DEPENDENT ################
##############       Linear Models     ################
#######################################################

Initial Regression

```{r}
fitdata <- resdata  %>%
  select(atsratio,
         Percent_Black, Percent_Hispanic,
         LANDSIZE, MEDIAN.INCOME,age) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)

fitdata <- cbind(fitdata,covariates)

mod <- lm(atsratio ~   Percent_Black + Percent_Hispanic + LANDSIZE  + MEDIAN.INCOME + KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)
plot(mod)
```


We find a significant result, but the model diagnostics are poor. Constant variance is an issue



Transformed  Land Size, and Median Income 

SIMPLE LINEAR MODEL
```{r}
fitdata <- resdata  %>%
  select(atsratio,
         Percent_Black,Percent_Hispanic,
         LogLandSize,LogMedianIncome,age) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)

fitdata <- cbind(fitdata,covariates)

mod <- lm(atsratio ~  Percent_Black  +  Percent_Hispanic + LogLandSize + LogMedianIncome  + KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)
plot(mod)

```

We find a significant result. Also, the model residuals are much better. Simple linear regression though.


SPECIFIC LINEAR MODEL
```{r}
fitdata <- resdata  %>%
  select(atsratio,
         Percent_Black,Percent_Hispanic,
         LogMedianLandSize,PctLandSizeDiff_Above, PctLandSizeDiff_Below,
         LogMedianTractSalesPrice,PctSalePriceDiff_Above,PctSalePriceDiff_Below,
         LogMedianIncome,age) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)

fitdata <- cbind(fitdata,covariates)

mod <- lm(atsratio ~ Percent_Black + Percent_Hispanic + LogMedianIncome + LogMedianLandSize + PctLandSizeDiff_Above + PctLandSizeDiff_Below  + LogMedianTractSalesPrice  + PctSalePriceDiff_Above + PctSalePriceDiff_Below  + KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)
plot(mod)

vif(mod)

```



##############################
All races
```{r}
fitdata <- resdata  %>%
  select(atsratio,
         Percent_NotHispanic_White,Percent_Hispanic, Percent_Black,
         LogMedianIncome,LogLandSize,age) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)

fitdata <- cbind(fitdata,covariates)

mod <- lm(atsratio ~  Percent_Black + Percent_NotHispanic_White +  Percent_Hispanic + LogLandSize + LogMedianIncome  + KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)
plot(mod)

```
#############################

If we include all races, then the variable for White Population becomes insignificant, if we remove percent black, the percent white has a positive coefficient. It seems to me that these variables are foils. They are providing the same information in my opinion. We ought to exclude percent white population as the reference category. We will include models with this variable in case requested


############################################################
##############  Assessed Value AS DEPENDENT ################
##############         LINEAR MODELS        ################
############################################################

Untransformed Variables

```{r}
fitdata <- resdata  %>%
  select(ASSESSEDVAL,
         Percent_Black,Percent_Hispanic,
         SALEPRICE,LANDSIZE, MEDIAN.INCOME,age) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)

fitdata <- cbind(fitdata,covariates)

mod <- lm(ASSESSEDVAL ~   Percent_Black + Percent_Hispanic + LANDSIZE + SALEPRICE + MEDIAN.INCOME + KITCHENS + FULLBATHS + HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)
plot(mod)

```


We find a significant result, but see diagnostic issues with the residual distribution. Very horn like. Suggests a log transformation




With Transformed Variables
SIMPLE LINEAR MODLE
```{r}
fitdata <- resdata  %>%
  select(LogAssessedVal, 
         Percent_Black, Percent_Hispanic,
         LogSalesPrice, LogLandSize, LogMedianIncome,age) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)

fitdata <- cbind(fitdata,covariates)

mod <- lm(LogAssessedVal ~   Percent_Black + Percent_Hispanic + LogSalesPrice + LogLandSize + LogMedianIncome + KITCHENS + FULLBATHS + HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)
plot(mod)

```


We see a significant finding, residuals are much more evenly distributed

SPECIFIC LINEAR MODEL
```{r}
fitdata <- resdata  %>%
  select(LogAssessedVal,
         Percent_Black,Percent_Hispanic,
         LogMedianLandSize,PctLandSizeDiff_Above, PctLandSizeDiff_Below,
         LogMedianTractSalesPrice,PctSalePriceDiff_Above,PctSalePriceDiff_Below,
         LogMedianIncome,age) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)

fitdata <- cbind(fitdata,covariates)

mod <- lm(LogAssessedVal ~ Percent_Black + Percent_Hispanic + LogMedianIncome + LogMedianLandSize + PctLandSizeDiff_Above + PctLandSizeDiff_Below  + LogMedianTractSalesPrice  + PctSalePriceDiff_Above + PctSalePriceDiff_Below  + KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)
plot(mod)
vif(mod)
```




#############################
```{r}
fitdata <- resdata  %>%
  select(LogAssessedVal, 
         Percent_Black, Percent_Hispanic, Percent_NotHispanic_White,
         LogSalesPrice, LogLandSize, LogMedianIncome,age) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)

fitdata <- cbind(fitdata,covariates)

mod <- lm(LogAssessedVal ~   Percent_Black + Percent_NotHispanic_White + Percent_Hispanic + LogSalesPrice + LogLandSize + LogMedianIncome + KITCHENS + FULLBATHS + HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)
plot(mod)

```
#####################
Same result when adding all race variables. I think, as I've stated, that we ought to exclude Percent_NotHispanic_White as a reference category



#######################################################
##############  ATS RATIO AS DEPENDENT ################
##############   Mixed Effect Models   ################
#######################################################


From here on out we will only use transformed variables

SIMPLE MIXED EFFECT MODEL
```{r}
fitdata <- resdata %>% 
  select(atsratio,
         Percent_Black, Percent_Hispanic,
         LogLandSize,
         LogMedianLandSize,LogMedianIncome,LogMedianTractSalesPrice,age,
         GEO_TRACT)
 
scaled.dat <- fitdata %>% 
  select(-c("GEO_TRACT")) %>% scale(center = T,scale=T)

fitdata <- as.data.frame(scaled.dat) %>% 
  mutate(GEO_TRACT = fitdata$GEO_TRACT)

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)


fitdata <- cbind(fitdata,covariates)

mod <- lmer(atsratio ~ Percent_Black  +Percent_Hispanic + LogMedianIncome + LogMedianLandSize  + LogLandSize + LogMedianTractSalesPrice  + (1|GEO_TRACT) + KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)

vif(mod)

qqnorm(resid(mod))
qqline(resid(mod))

ICC = 0.04037 / (0.04037 + 0.75068)
1-ICC

plot(mod)

ggplot(data.frame(eta=predict(mod,type="link"),pearson=residuals(mod,type="pearson")),
      aes(x=eta,y=pearson)) +
  geom_point() +
  xlab("Fitted Values") + 
  ylab("Standardized Residuals") +
  theme_bw()
```
 
We find significant results. The model diagnostics look good. Residuals are constant and normally distributed

```{r}
ATSRatio_stdev <- sd(resdata$atsratio)

cat("The standard deviation of assessment ratio is", ATSRatio_stdev,"\n")
cat("---","\n")

cat("In the first model we see that Percent Black has a coefficient equal to -0.1218","\n")
cat("Which is about 12% of a standard deviation","\n")
cat("---","\n")

cat("So, 12% of", ATSRatio_stdev,"is:",ATSRatio_stdev*0.1218,"or 1.61%", "\n")
cat("---","\n")

cat("In other words, a neighboorhood with a one standard deviation increase in the Percent Black Population is subject to a 1.61% decrease in their taxable property value","\n")

cat("---","\n")

cat("This is the difference between an annual property tax bill of $1000 versus $",1000 -(1000*(ATSRatio_stdev*0.1218)),"\n")

"A coefficient of 0.1218 indicates that a one standard deviation increase in percent black is associated with a 0.1218 standard devation increase in the assessment ratio. This is 12% of a standard deviation. The standard deviation of the assessment ratio is about 0.13, so 12% of that is 0.016 or 1.16%. A neighborhood with a one standard deviation increase in the percent of black people is subject to about a 1.16% increase in their taxable property values"



```





With more specific house difference characteristics
SPECIFIC MIXED EFFECT MODEL
```{r}
fitdata <- resdata %>% 
  select(atsratio,
         Percent_Black, Percent_Hispanic,
         LogMedianLandSize,PctLandSizeDiff_Above, PctLandSizeDiff_Below,
         LogMedianTractSalesPrice,PctSalePriceDiff_Above,PctSalePriceDiff_Below,
         LogMedianIncome,age,
         GEO_TRACT)
 
scaled.dat <- fitdata %>% 
  select(-c("GEO_TRACT")) %>% scale(center = T,scale=T)

fitdata <- as.data.frame(scaled.dat) %>% 
  mutate(GEO_TRACT = fitdata$GEO_TRACT)

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)


fitdata <- cbind(fitdata,covariates)

mod <- lmer(atsratio ~ Percent_Black + Percent_Hispanic + LogMedianIncome + LogMedianLandSize + PctLandSizeDiff_Above + PctLandSizeDiff_Below  + LogMedianTractSalesPrice  + PctSalePriceDiff_Above + PctSalePriceDiff_Below + (1|GEO_TRACT) + KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)
#vcov(mod)
anova(mod)

ICC = 0.1297/ (0.1297+ 0.5069)
1-ICC

vif(mod)
qqnorm(resid(mod))
qqline(resid(mod))


ggplot(data.frame(eta=predict(mod,type="link"),pearson=residuals(mod,type="pearson")),
      aes(x=eta,y=pearson)) +
  geom_point() +
  xlab("Fitted Values") + 
  ylab("Standardized Residuals") +
  theme_bw()

```
 
We control for more specific housing characteristics, we see the coefficient for Percent Black has increased dramatically.

 
 
Interpretation General Structure

```{r}
ATSRatio_stdev <- sd(resdata$atsratio)

cat("The standard deviation of assessment ratio is", ATSRatio_stdev,"\n")
cat("---","\n")

-0.4642
cat("In the first model we see that Percent Black has a coefficient equal to -0.4642","\n")
cat("Which is about 46% of a standard deviation","\n")
cat("---","\n")

cat("So, 46% of", ATSRatio_stdev,"is:",ATSRatio_stdev*0.4642,"or 6.14%", "\n")
cat("---","\n")

cat("In other words, a neighboorhood with a one standard deviation increase in the Percent Black Population is subject to a 6.14% decrease in their taxable property value","\n")

cat("---","\n")

cat("This is the difference between an annual property tax bill of $1000 versus $",1000 -(1000*(ATSRatio_stdev*0.4642)),"\n")

"A coefficient of -0.4642 indicates that a one standard deviation increase in percent black is associated with a 0.4642 standard deviation decrease in the assessment ratio. This is 46% of a standard deviation. The standard deviation of the assessment ratio is about 0.13, so 46% of that is 0.0614 or 6.14%. A neighborhood with a one standard deviation increase in the percent of black people is subject to about a 6.14% decrease in their taxable property values"


```


############################################################
##############  Assessed Value AS DEPENDENT ################
##############      Mixed Effect Models     ################
############################################################

SIMPLE MIXED EFFECT MODEL
```{r}
fitdata <- resdata %>% 
  select(LogAssessedVal,
         Percent_Black, Percent_Hispanic,
         LogLandSize, LogSalesPrice,
         LogMedianLandSize,LogMedianIncome,LogMedianTractSalesPrice,age,
         GEO_TRACT)
 
scaled.dat <- fitdata %>% 
  select(-c("GEO_TRACT")) %>% scale(center = T,scale=T)

fitdata <- as.data.frame(scaled.dat) %>% 
  mutate(GEO_TRACT = fitdata$GEO_TRACT)

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)


fitdata <- cbind(fitdata,covariates)

mod <- lmer(LogAssessedVal ~ Percent_Black  + Percent_Hispanic + LogSalesPrice + LogMedianIncome + LogMedianLandSize  + LogLandSize + LogMedianTractSalesPrice  + (1|GEO_TRACT) + KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)

vif(mod)

qqnorm(resid(mod))
qqline(resid(mod))

ICC = 0.01334 / (0.01334 + 0.05005)
1-ICC

plot(mod)

ggplot(data.frame(eta=predict(mod,type="link"),pearson=residuals(mod,type="pearson")),
      aes(x=eta,y=pearson)) +
  geom_point() +
  xlab("Fitted Values") + 
  ylab("Standardized Residuals") +
  theme_bw()
```

Residuals look good.

Inference on Log Sales Price might be really interesting here

We also still see a negative impact of percent black population

```{r}
AssesVal <- sd(resdata$LogAssessedVal)

cat("The standard deviation of assessment ratio is", AssesVal,"\n")
cat("---","\n")

-0.4642
cat("In the first model we see that Percent Black has a coefficient equal to -0.150","\n")
cat("Which is about 15% of a standard deviation","\n")
cat("---","\n")

cat("So, 15% of", AssesVal,"is:",AssesVal*0.150,"or 7.30%", "\n")
cat("---","\n")

cat("In other words, a neighboorhood with a one standard deviation increase in the Percent Black Population is subject to a 7.30%% decrease in their taxable property value","\n")

cat("---","\n")

#cat("This is the difference between an annual property tax bill of $1000 versus $",1000 -(1000*(AssesVal*0.150)),"\n")

"A coefficient of -0.150 indicates that a one standard deviation increase in percent black is associated with a 0.150 standard deviation decrease in the Log Assessment Value. This is 15% of a standard deviation. The standard deviation of the assessment ratio is about 0.487, so 15% of that is 0.0731 or 7.31%. A neighborhood with a one standard deviation increase in the percent of black people is subject to about a 7.31% decrease in their Log Assessment Value"


```
Model with more precise housing characteristics

```{r}
fitdata <- resdata %>% 
  select(LogAssessedVal,
         Percent_Black, Percent_Hispanic,
         LogMedianLandSize,PctLandSizeDiff_Above, PctLandSizeDiff_Below,
         LogMedianTractSalesPrice,PctSalePriceDiff_Above,PctSalePriceDiff_Below,
         LogMedianIncome,age,
         GEO_TRACT)
 
scaled.dat <- fitdata %>% 
  select(-c("GEO_TRACT")) %>% scale(center = T,scale=T)

fitdata <- as.data.frame(scaled.dat) %>% 
  mutate(GEO_TRACT = fitdata$GEO_TRACT)

covariates <- resdata %>% select(KITCHEN_FAC, COND_FAC, QUAL_FAC, BATH_FAC,TYPE_FAC, KITCHENS, FULLBATHS, BEDROOMS,HALFBATH,PRIM_WALL,salemonth,saleyear)


fitdata <- cbind(fitdata,covariates)

mod <- lmer(LogAssessedVal ~ Percent_Black + Percent_Hispanic  + LogMedianIncome + LogMedianLandSize + PctLandSizeDiff_Above + PctLandSizeDiff_Below  + LogMedianTractSalesPrice  + PctSalePriceDiff_Above + PctSalePriceDiff_Below + (1|GEO_TRACT) + KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear + age, data = fitdata)

summary(mod)

vif(mod)
qqnorm(resid(mod))
qqline(resid(mod))

ICC = 0.01496 / (0.01496 + 0.01496)
1-ICC

plot(mod)

ggplot(data.frame(eta=predict(mod,type="link"),pearson=residuals(mod,type="pearson")),
      aes(x=eta,y=pearson)) +
  geom_point() +
  xlab("Fitted Values") + 
  ylab("Standardized Residuals") +
  theme_bw()
```





```{r}
AssesVal <- sd(resdata$LogAssessedVal)

cat("The standard deviation of assessment ratio is", AssesVal,"\n")
cat("---","\n")


cat("In the first model we see that Percent Black has a coefficient equal to -0.1518","\n")
cat("Which is about 15.2% of a standard deviation","\n")
cat("---","\n")

cat("So, 15.2% of", AssesVal,"is:",AssesVal*0.1518,"or 7.4%", "\n")
cat("---","\n")

cat("In other words, a neighboorhood with a one standard deviation increase in the Percent Black Population is subject to a 7.4%% decrease in their taxable property value","\n")

cat("---","\n")

#cat("This is the difference between an annual property tax bill of $1000 versus $",1000 -(1000*(AssesVal*0.150)),"\n")

"A coefficient of -0.1518 indicates that a one standard deviation increase in percent black is associated with a 0.1518 standard deviation decrease in the Log Assessment Value. This is 15.2% of a standard deviation. The standard deviation of the assessment ratio is about 0.487, so 15.2% of that is 0.0739 or 7.4%. A neighborhood with a one standard deviation increase in the percent of black people is subject to about a 7.4% decrease in their Log Assessment Value"


```






SubPOP

Propensity Score Matching

Use Majority Black Neighborhoods as the matching criteria --> it is a 0 or 1



Once matched observations are found, then do regression
    
    - One STDEVIATION away from mean: Logistic Regression
    
    
Do it with all data & all covariates  

Report Results in this way

      - Simple Model
      - Added Covariates
      - Propensity Matched using housing characteristics
  

Initial Data Analysis for Logistic Regressions
```{r}
ggplot(resdata, aes(atsratio)) +
  geom_histogram(bins = 200)+ 
  xlim(0.5,1.4) + 
  ylim(0,115)+
  xlab("ATS Ratio") +
  ylab("Frequency") 

ggplot(filter(resdata, Majority_Black ==1), aes(atsratio)) +
  geom_histogram(bins = 200)+ 
  xlim(0.5,1.4) + 
  ylim(0,80)+
  xlab("ATS Ratio") +
  ylab("Frequency") 


ggplot(filter(resdata, Majority_Black ==1), aes(atsratio)) +
  geom_histogram(bins = 200)+ 
  xlim(0.5,1.4) + 
  ylim(0,35)+
  xlab("ATS Ratio") +
  ylab("Frequency") 

ggplot(filter(resdata, Majority_Black ==0), aes(atsratio)) +
  geom_histogram(bins = 200)+ 
  xlim(0.5,1.4) + 
  ylim(0,80)+
  xlab("ATS Ratio") +
  ylab("Frequency") 


ggplot(filter(resdata, Majority_White ==1), aes(atsratio)) +
  geom_histogram(bins = 200)+ 
  xlim(0.5,1.4) + 
  ylim(0,80)+
  xlab("ATS Ratio") +
  ylab("Frequency")
```
  
Percent Black
ATSDev_Indicator_LOW
```{r}

### Simple Model

fitdata <- resdata %>% 
  select(Percent_Black) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select(ATSDev_Indicator_LOW,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_LOW ~ Percent_Black + (1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")
summary(mod1)
exp(0.38058)


### Intermediate Model

fitdata <- resdata %>% 
  select(Percent_Black,
         LogSalesPrice) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select(ATSDev_Indicator_LOW,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_LOW ~ Percent_Black + LogSalesPrice + (1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")
summary(mod1)
exp(1.17450)


### Specific Model

fitdata <- resdata %>% 
  select(Percent_Black,
         LogLandSize,LogMedianIncome,age,LogSalesPrice) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select( KITCHEN_FAC,KITCHENS,COND_FAC,FULLBATHS,HALFBATH,QUAL_FAC,TYPE_FAC,PRIM_WALL,salemonth,saleyear, BEDROOMS,ATSDev_Indicator_LOW,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_LOW ~ Percent_Black + LogSalesPrice +LogLandSize + LogMedianIncome+ age +  KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear+(1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")

summary(mod1)
exp(1.54064)

```


Percent Black
ATSDev_Indicator_HIGH
```{r}
### Simple Model

fitdata <- resdata %>% 
  select(Percent_Black) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select(ATSDev_Indicator_HIGH,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_HIGH ~ Percent_Black + (1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")
summary(mod1)
exp(0.21934)


### Intermediate Model

fitdata <- resdata %>% 
  select(Percent_Black,
         LogSalesPrice) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select(ATSDev_Indicator_HIGH,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_HIGH ~ Percent_Black + LogSalesPrice + (1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")
summary(mod1)
exp(-1.03043)


### Specific Model

fitdata <- resdata %>% 
  select(Percent_Black,
         LogLandSize,LogMedianIncome,age,LogSalesPrice) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select( KITCHEN_FAC,KITCHENS,COND_FAC,FULLBATHS,HALFBATH,QUAL_FAC,TYPE_FAC,PRIM_WALL,salemonth,saleyear, BEDROOMS,ATSDev_Indicator_HIGH,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_HIGH ~ Percent_Black + LogSalesPrice +LogLandSize + LogMedianIncome+ age +  KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear+(1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")

summary(mod1)
exp(-1.33922)

```




Percent White
ATSDev_Indicator_LOW
```{r}
### Simple Model

fitdata <- resdata %>% 
  select(Percent_White) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select(ATSDev_Indicator_LOW,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_LOW ~ Percent_White + (1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")
summary(mod1)
exp(-0.47538)


### Intermediate Model

fitdata <- resdata %>% 
  select(Percent_White,
         LogSalesPrice) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select(ATSDev_Indicator_LOW,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_LOW ~ Percent_White + LogSalesPrice + (1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")
summary(mod1)
exp(-1.43596)


### Specific Model

fitdata <- resdata %>% 
  select(Percent_White,
         LogLandSize,LogMedianIncome,age,LogSalesPrice) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select( KITCHEN_FAC,KITCHENS,COND_FAC,FULLBATHS,HALFBATH,QUAL_FAC,TYPE_FAC,PRIM_WALL,salemonth,saleyear, BEDROOMS,ATSDev_Indicator_LOW,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_LOW ~ Percent_White + LogSalesPrice +LogLandSize + LogMedianIncome+ age +  KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear+(1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")

summary(mod1)
exp(-2.03280)

```



Percent White
ATSDev_Indicator_HIGH
```{r}
### Simple Model

fitdata <- resdata %>% 
  select(Percent_White) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select(ATSDev_Indicator_HIGH,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_HIGH ~ Percent_White + (1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")
summary(mod1)
exp(-0.22584)


### Intermediate Model

fitdata <- resdata %>% 
  select(Percent_White,
         LogSalesPrice) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select(ATSDev_Indicator_HIGH,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_HIGH ~ Percent_White + LogSalesPrice + (1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")
summary(mod1)
exp(1.25121)


### Specific Model

fitdata <- resdata %>% 
  select(Percent_White,
         LogLandSize,LogMedianIncome,age,LogSalesPrice) %>% 
  scale(center = T,scale=T) %>%
  as.data.frame()
 
covariates <- resdata %>% select( KITCHEN_FAC,KITCHENS,COND_FAC,FULLBATHS,HALFBATH,QUAL_FAC,TYPE_FAC,PRIM_WALL,salemonth,saleyear, BEDROOMS,ATSDev_Indicator_HIGH,GEO_TRACT)

fitdata <- cbind(fitdata,covariates)

mod1 <- glmer(ATSDev_Indicator_HIGH ~ Percent_White + LogSalesPrice +LogLandSize + LogMedianIncome+ age +  KITCHENS+ FULLBATHS+ HALFBATH + BEDROOMS + KITCHEN_FAC + COND_FAC + QUAL_FAC + TYPE_FAC + PRIM_WALL + salemonth + saleyear+(1|GEO_TRACT),nAGQ = 0,data = fitdata, family ="binomial")

summary(mod1)
exp(1.61931)

```




