---
title: "Findings"
output: html_document
---

Final

Research Question

Background on Dependent variable - Assessment Ratio


Data Provided
```{r}
setwd("C:/Users/Vinnie/Documents")
load("res_data_w_geo.dta")
Initial <-data.frame(res_data_w_geo)
print(Initial)
```
All variables
```{r}
names(Initial)
```

Continuous Variables of Interest

Sale Price, Land Size, Land Value, Improvement Value, Assessment Value
```{r}
ggplot(Initial, aes(SALEPRICE)) +
  geom_histogram(bins = 200)

ggplot(Initial, aes(ASSESSEDVAL)) +
  geom_histogram(bins = 200)

ggplot(Initial, aes(LANDSIZE)) +
  geom_histogram(bins = 200)

ggplot(Initial, aes(LANDVAL)) +
  geom_histogram(bins = 200)

Initial$atsratio <- Initial$ASSESSEDVAL / Initial$SALEPRICE

ggplot(Initial, aes(atsratio)) +
  geom_histogram(bins = 200)

```


We first look at the main variables of interest & discover that they are all extremely right tailed.

We know from prior knowledge that this would be the case. Many weird sales/properties exist, e.g. donations, auctions, foreclosures, condemtions. 

In an attempt to remedy this we remove the observations outside the interquartile range


Look at effect of this change on distribution of ats ratio

```{r}
ggplot(resdata, aes(atsratio)) +
  geom_histogram(bins = 200)


ggplot(resdata, aes(log(SALEPRICE))) +
  geom_histogram(bins = 200)

ggplot(resdata, aes(log(ASSESSEDVAL))) +
  geom_histogram(bins = 200)
```



Categorical Variables

Building Type, Building Quality, Number of Buildings, Building Condition, Bedrooms, Kitchens, Baths, Half-Baths, Garages
```{r}
BLDFreqs <- resdata %>% group_by(BLDTYPE) %>% summarize(n = n())
plotgroup <- resdata %>% left_join(BLDFreqs, by = c("BLDTYPE"))

ggplot(filter(plotgroup, n > 400), aes(BLDTYPE)) +
  geom_bar() #+ theme(axis.text.x = element_blank())

level_order_qual <- c("A","B","C","D","E","NA")

ggplot(resdata, aes(x = factor(QUAL, level = level_order_qual))) +
  geom_bar()# + theme(axis.text.x = element_blank())

level_order_cond <- c("EX - Excellent","VG - Very Good","GD - Good","AV - Average","FR - Fair","PR - Poor","VP - Very Poor","UN - Unsound")

ggplot(resdata, aes(x = factor(COND, level = level_order_cond))) +
  geom_bar()# + theme(axis.text.x = element_blank())

ggplot(resdata, aes(NUM_BLDS)) +
  geom_bar()

ggplot(resdata, aes(KITCHENS)) +
  geom_bar()

ggplot(resdata, aes(BEDROOMS)) + 
  geom_bar()
```


Temporal Variables

Date sold, Year Built
```{r}
ggplot(resdata, aes(SALEDATE,fill = factor(QUAL_recode, level = level_order_qual))) +
  geom_histogram(bins=100) +
  theme(legend.title=element_blank())

ggplot(resdata, aes(YEARBLT, fill = factor(QUAL_recode, level = level_order_qual))) +
  geom_histogram(bins=100) +
  theme(legend.title=element_blank())

ggplot(resdata, aes(YEARBLT, fill = factor(COND, level = level_order_cond))) +
  geom_histogram(bins=100)

```


Visualizations of variables with ats ratio

```{r}
ggplot(resdata, aes(atsratio, fill = factor(QUAL_recode, level = level_order_qual))) +
  geom_histogram(bins=100) +
  theme(legend.title=element_blank())


ggplot(resdata, aes(atsratio, fill = factor(COND, level = level_order_cond))) +
  geom_histogram(bins=100)+
  theme(legend.title=element_blank())
```






Median ATS Ratio by Income Decile
```{r}
tapply(resdata$atsratio,resdata$IncomeDecile, summary)
```

    - The Median Assessment to Sale ratio increases as the Median Income of the tract Increase
    
    - As the income increases, the assessment approaches the sale value of the house
    


Median ATS Ratio by Sales Decile
```{r}
tapply(resdata$atsratio, resdata$salesdecile, summary)
```

    - The Median Assessment to Sale ratio decreases as the sale price increases
    
    - As the sale price of a house increases, the assessment diverges from the sale value of the house
    
    - Higher prices homes are under assessed  
    
    
Median ATS Ratio by Percent Black Population Decile
```{r}
blackpop <- tapply(resdata$atsratio,resdata$blackdecile, summary)

medians <- c()
deciles <- 1:10
for (i in 1:10){
  medians[i] <- as.numeric(blackpop[[i]]['Median']) }

BlackATS <- data.frame("Medians" = medians,
                       "Deciles" = deciles)

lm(Medians ~ Deciles,data=BlackATS);anova(lm(Medians ~ Deciles,data=BlackATS))
```

    - The Median Assessment to Sale ratio decreases as the percent black population increases
    
    - As the percent of the black population increases in a tract, the assessment diverges from the sale value of the house
    
    - Homes in black neighborhoods are under assessed 
    
    
Median ATS Ratio by Percent White Population Decile
```{r}
tapply(resdata$atsratio,resdata$whitedecile, summary)
whitepop <- tapply(resdata$atsratio,resdata$whitedecile, summary)

medians <- c()
deciles <- 1:10
for (i in 1:10){
  medians[i] <- as.numeric(whitepop[[i]]['Median']) }

WhiteATS <- data.frame("Medians" = medians,
                       "Deciles" = deciles)

lm(Medians ~ Deciles,data=WhiteATS);anova(lm(Medians ~ Deciles,data=WhiteATS))

plot(lm(atsratio ~ Percent_White, data=resdata))


plot(lm(atsratio ~ Percent_Black, data=resdata)) # higher ats ratios the variance is going down
# less variability around large ats ratios

```

    - The Median Assessment to Sale ratio increases as the percent white population increases
    
    - As the percent of the white population increases in a tract, the assessment approaches the sale value of the house
    
    - Homes in white neighborhoods are over assessed (relative to black neighborhoods), homes are assessed closer to their true sale value
    
    - Homes in white neighborhoods show the opposite trend to black neighborhoods
    
    
Median ATS Ratio by Percent Hispanic Population Decile
```{r}
tapply(resdata$atsratio, resdata$hispaniddecile, summary)
hispanicpop <- tapply(resdata$atsratio, resdata$hispaniddecile, summary)

medians <- c()
deciles <- 1:10
for (i in 1:10){
  medians[i] <- as.numeric(hispanicpop[[i]]['Median']) }

HispATS <- data.frame("Medians" = medians,
                       "Deciles" = deciles)

lm(Medians ~ Deciles,data=HispATS);anova(lm(Medians ~ Deciles,data=HispATS))
```


    - See less of a trend here
    



    
    
    
